upstream project { 
    server my-node-user:8000 weight=10 max_fails=3 fail_timeout=10s; 
    server my-node-manager:8001 weight=10 max_fails=3 fail_timeout=10s;
}

server { 
    listen [::]:80;
    listen 80;

    server_name dev.hellotome.shop;

    location /user { 
        proxy_pass http://my-node-user:8000; 
    } 
    location /manager { 
        proxy_pass http://my-node-manager:8001; 
    } 
}

 # Redirect www to HTTPS non-www
server {
    listen 80;
    listen 443 ssl http2;

    server_name dev.hellotome.shop;

    location /user { 
        proxy_pass http://my-node-user:8000; 
    } 
    location /manager { 
        proxy_pass http://my-node-manager:8001; 
    } 

    return 301 https://dev.hellotome.shop$request_uri;
}

  # Main domain
server {
    listen 443 ssl http2 default_server;

    server_name dev.hellotome.shop;

    # Serve create react app build
    location / {
      root /var/lib/website;
      try_files $uri $uri/ /index.html;
    }

    # Certbot
    location /.well-known/ {
      root /var/lib/certbot;
    }
}